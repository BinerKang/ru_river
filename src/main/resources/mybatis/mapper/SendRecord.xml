<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.biner.ru.mapper.SendRecordMapper">

	<select id="getSendRecords" resultType="com.biner.ru.model.SendRecord">
		SELECT
			id,
			telphone,
			msg,
			result,
			DATE_FORMAT(created_time, '%Y-%m-%d %H:%i:%s') AS createdTime,
			DATE_FORMAT(updated_time, '%Y-%m-%d %H:%i:%s') AS updatedTime,
			created_by AS createdBy,
			updated_by AS updatedBy
		FROM
			t_send_record
		WHERE 1 = 1 
		<include refid="commonQuery"/>
		ORDER BY updated_time DESC
		LIMIT #{item.pageSize} OFFSET #{item.pageNo}
	</select>
	
	<select id="getSendRecordsCount" resultType="java.lang.Integer">
		SELECT
			count(1)
		FROM
			t_send_record
		WHERE 1 = 1
		<include refid="commonQuery"/>
	</select>
	
	<sql id="commonQuery">
		<if test="null != item.keyword"> 
		AND (
			telphone LIKE "%"#{item.keyword}"%"
			) 
		</if>
	</sql>
	
	<insert id="save" keyProperty="item.id" useGeneratedKeys="true">
		INSERT INTO t_send_record 
		(telphone, msg, updated_time, updated_by, created_time, created_by)
		VALUES
		(#{item.telphone}, #{item.msg}, now(), #{item.updatedBy}, now(), #{item.createdBy})
	</insert>

	<insert id="update" >
		UPDATE t_send_record SET
		 <if test="null != item.telphone"> telphone = #{item.telphone},</if>
		 <if test="null != item.msg"> msg = #{item.msg},</if>
		 <if test="null != item.result"> result = #{item.result},</if>
		 updated_time = now(),
		 updated_by = #{item.updatedBy}
		WHERE id = #{item.id}
	</insert>
	
</mapper>